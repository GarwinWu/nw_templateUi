!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EimMobileJsSdk=t()}(this,function(){"use strict";var i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}(),t=function(){function t(e){i(this,t),this.protocolSwitch=e||"new"}return a(t,[{key:"firstUpperCase",value:function(e){return e.toLowerCase().replace(/( |^)[a-z]/g,function(e){return e.toUpperCase()})}},{key:"randomId",value:function(e){e=e||10;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=t.length,i="",a=0;a<e;a++)i+=t.charAt(Math.floor(Math.random()*o));return i}},{key:"judge",value:function(){return-1<window.navigator.userAgent.indexOf("eimAndroid")?"eimAndroid":"eimios"}},{key:"getOption",value:function(e){return Object.assign({},this.opts,e)}},{key:"getCallbackName",value:function(e,t,o){var i=this.firstUpperCase(e),a=o?this.firstUpperCase(o):this.firstUpperCase(this.randomId(6));return"success"===t?"eimMobileJsSdk"+i+a+"Success":"eimMobileJsSdk"+i+a+"Faile"}},{key:"getProtocol",value:function(e,t,o,i){for(var a="",s="",c=arguments.length,r=Array(4<c?c-4:0),n=4;n<c;n++)r[n-4]=arguments[n];if("old"===e){s=r.join("_");var l=t.split("_");if(a="eim://"+l[0]+"_"+o+"_"+i,1<l.length)for(var u=1;u<t.split("_").length;u++)a+="_"+l[u];a+="/"+s}else a=(s=r.join("&"))?"eim://com.comtop.eim/"+t+"?succallback="+o+"&failcallback="+i+"&"+s:"eim://com.comtop.eim/"+t+"?succallback="+o+"&failcallback="+i;return a}},{key:"createCallbackFactory",value:function(e,t){var o=this.getCallbackName(t,"success",e.id),i=this.getCallbackName(t,"fail",e.id);return window[o]=e.success,window[i]=e.fail,{suc:o,fail:i}}},{key:"createProtocol",value:function(e,t,o){"new"===o&&"has no this protocol"===e||"old"===o&&"has no this protocol"===t||(window.location.href="new"===o?e:t)}},{key:"createSimpleJssdkFuncFactory",value:function(e,t,o,i){var a=this.getOption(e),s=this.createCallbackFactory(a,t),c=""===o?"has no this protocol":this.getProtocol("new",o,s.suc,s.fail),r=""===i?"has no this protocol":this.getProtocol("old",i,s.suc,s.fail);this.createProtocol(c,r,this.protocolSwitch)}},{key:"createSingleParamJssdkFuncFactory",value:function(e,t,o,i,a,s){var c=this.createCallbackFactory(e,t),r=""===o?"has no this protocol":this.getProtocol("new",o,c.suc,c.fail,i),n=""===a?"has no this protocol":this.getProtocol("old",a,c.suc,c.fail,s);this.createProtocol(r,n,this.protocolSwitch)}}]),t}();return function(e){function o(e){i(this,o);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.protocolSwitch=e||"new",t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,t),a(o,[{key:"selectPhoto",value:function(e){var t=this.getOption(e),o=t.count?t.count:1,i=t.singleCrop?t.singleCrop:1,a=this.createCallbackFactory(t,"selectPhoto");this.createProtocol(this.getProtocol("new","photo/select",a.suc,a.fail,"limit="+o,"singlecrop="+i),this.getProtocol("old","selectPhoto",a.suc,a.fail,o,i),this.protocolSwitch)}},{key:"imcrop",value:function(e){var t=this.getOption(e),o=t.aspectratio?t.aspectratio:1,i=t.quality?t.quality:0,a=t.shotonly?t.shotonly:0,s=this.createCallbackFactory(t,"imcrop");this.createProtocol(this.getProtocol("new","system/imcrop",s.suc,s.fail,"aspectratio="+o,"quality="+i,"shotonly="+a),this.getProtocol("old","imcrop",s.suc,s.fail,o,i,a),this.protocolSwitch)}},{key:"selectUser",value:function(e,t){var o=this.getOption(e),i=o.maxLimit||99,a=this.createCallbackFactory(o,"selectUser"),s=o.ignoreself?"/ignoreSelf":"",c=o.ignoreself?1:0,r=o.selecteduids&&0!==o.selecteduids.length?""+o.selecteduids.join("_"):"",n=o.selecteduids&&0!==o.selecteduids.length?""+o.selecteduids.join(","):"",l=t?"user/selectUserWith4A":"user/select";this.createProtocol(this.getProtocol("new",l,a.suc,a.fail,"maxlimit="+i,"ignoreself="+c,"selecteduids="+n),t?"has no this protocol":this.getProtocol("old","selectUser_"+i,a.suc,a.fail,""+r+s),this.protocolSwitch)}},{key:"select4AUser",value:function(e){this.selectUser(e,!0)}},{key:"selectDept",value:function(e){var t=this.getOption(e),o=t.maxLimit||99,i=this.createCallbackFactory(t,"selectDept"),a=t.ignoreself?"/ignoreself":"",s=t.ignoreself?1:0,c=t.selectedids&&0!==t.selectedids.length?t.selectedids.join("_"):"",r=t.selectedids&&0!==t.selectedids.length?""+t.selectedids.join(","):"";this.createProtocol(this.getProtocol("new","dept/select",i.suc,i.fail,"maxlimit="+o,"ignoreself="+s,"selectedids="+r),this.getProtocol("old","selectDept_"+o,i.suc,i.fail,""+c+a),this.protocolSwitch)}},{key:"screenRotation",value:function(e){var t=this.getOption(e),o=t.param?t.param:"vertical",i=this.createCallbackFactory(t,"screenRotation");this.createProtocol(this.getProtocol("new","system/screen",i.suc,i.fail,"action="+o),this.getProtocol("old","screenRotation",i.suc,i.fail,""+o),this.protocolSwitch)}},{key:"phoneCall",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"phoneCall","system/phonecall","phonenum="+t.phoneNumber,"phoneCall",t.phoneNumber)}},{key:"openQRCode",value:function(e){var t=this.getOption(e),o=t.needResult?t.needResult:1;this.createSingleParamJssdkFuncFactory(t,"openQRCode","qrcode/scan","needresult="+o,"openQRCode",o)}},{key:"scanQRCode",value:function(e){var t=this.getOption(e),o=1===t.needResult||0===t.needResult?t.needResult:1;this.createSingleParamJssdkFuncFactory(t,"scanQRCode","qrcode/scan","needresult="+o,"scanQRCode",o)}},{key:"openEditText",value:function(e){var t=this.getOption(e),o=t.text?t.text:"发送",i=t.type?t.type:"number",a=t.content,s=this.createCallbackFactory(t,"openEditText");this.createProtocol(this.getProtocol("new","web/input/text",s.suc,s.fail,"type="+i,"text="+o,"content="+a),this.getProtocol("old","openEditText",s.suc,s.fail,o,i,a),this.protocolSwitch)}},{key:"openFile",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"openFile","file/open","json="+o,"openFile",o)}},{key:"uploadFile",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"uploadFile","file/upload","json="+o,"uploadFile",o)}},{key:"previewFile",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"previewFile","file/preview","json="+o,"previewFile",o)}},{key:"getFileDownloadList",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"getFileDownloadList","file/getdownloadlist","json="+o,"getFileDownloadList",o)}},{key:"menuList",value:function(e){var t=this.getOption(e),o=t.menulist&&0!==t.menulist.length?t.menulist.join("_"):"",i=t.menulist&&0!==t.menulist.length?t.menulist.join(","):"";this.createSingleParamJssdkFuncFactory(t,"menuList","menu/list","menulist="+i,"menuList",o)}},{key:"onMenu",value:function(e){var t=this.getOption(e),o=t.type;this.createSingleParamJssdkFuncFactory(t,"onMenu","web/menu/action","name="+o,"onMenu",o)}},{key:"logout",value:function(e){this.createSimpleJssdkFuncFactory(e,"logout","user/logout","logout")}},{key:"closeWindow",value:function(e){var t="eimAndroid"===this.judge()?"closecurrentwindow":"closeWindow";this.createSimpleJssdkFuncFactory(e,"closeWindow","web/close",t)}},{key:"banPull",value:function(e){var t=this.getOption(e),o=t?t.pull:"";this.createSingleParamJssdkFuncFactory(t,"banPull","web/banpull","pull="+o,"banPull",null)}},{key:"goBack",value:function(e){var t="eimAndroid"===this.judge()?"closeWindow":"goBack";this.createSimpleJssdkFuncFactory(e,"goBack","web/goback",t)}},{key:"hiddenNavigationBar",value:function(e){var t=this.getOption(e),o=t?t.action:"";this.createSingleParamJssdkFuncFactory(t,"hiddenNavigationBar","web/navigationbar/toggler","action="+o,"hiddenNavigationBar",null)}},{key:"closeShouldAutorotate",value:function(e){this.createSimpleJssdkFuncFactory(e,"closeShouldAutorotate","system/closerotate","closeShouldAutorotate")}},{key:"clipBoard",value:function(e){var t=this.getOption(e),o=t.text;this.createSingleParamJssdkFuncFactory(t,"clipBoard","system/clipboard","content="+o,"clipBoard",o)}},{key:"refreshPubService",value:function(e){var t=this.getOption(e),o=t.action;this.createSingleParamJssdkFuncFactory(t,"refreshPubService","pubservice/refresh","action="+o,"refreshpubservice",o)}},{key:"setEarpieceMode",value:function(e){this.createSimpleJssdkFuncFactory(e,"setEarpieceMode","system/earpiece","setEarpieceMode")}},{key:"isInstalled",value:function(e){var t=this.getOption(e),o=t.packageName;this.createSingleParamJssdkFuncFactory(t,"isInstalled","app/installed","name="+o,"isInstalled",o)}},{key:"choosePhoto",value:function(e){var t=this.getOption(e),o=t.maxLimit;this.createSingleParamJssdkFuncFactory(t,"choosePhoto","photo/choose","maxlimit="+o,"choosePhoto",o)}},{key:"setTitleVisibility",value:function(e){var t=this.getOption(e),o=t.isShow||void 0===t.isShow?"visible":"gone",i=this.createCallbackFactory(t,"groupCreate");this.createProtocol("has no this protocol",this.getProtocol("old","setTitleVisibility",i.suc,i.fail,o),this.protocolSwitch)}},{key:"playVideo",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"playVideo","video/play","json="+t.videoJson,"playVideo",t.videoJson)}},{key:"showVoiceInput",value:function(e){this.createSimpleJssdkFuncFactory(e,"showVoiceInput","voice/input","showVoiceInput")}},{key:"openZoom",value:function(e){this.createSimpleJssdkFuncFactory(e,"openZoom","system/zoom","openZoom")}},{key:"getLocation",value:function(e){this.createSimpleJssdkFuncFactory(e,"getLocation","system/getlocation","getLocation")}},{key:"groupCreate",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"groupCreate");this.createProtocol(this.getProtocol("new","group/create",o.suc,o.fail,"groupname="+t.groupname,"groupmark="+t.groupmark),this.getProtocol("old","groupCreate",o.suc,o.fail),this.protocolSwitch)}},{key:"dissolve",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"dissolve","group/dissolve","roomid="+t.roomId,"groupDissolveWithRoomId",t.roomId)}},{key:"groupOpen",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"groupOpen","group/open","roomid="+t.roomId,"groupOpenWithRoomId",t.roomId)}},{key:"groupExit",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"groupExit","group/exit","roomid="+t.roomId,"exitGroup",t.roomId)}},{key:"refreshMyInfo",value:function(e){this.createSimpleJssdkFuncFactory(e,"refreshMyInfo","user/refreshself","refreshMyInfo")}},{key:"showUserInfoWithUserId",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"showUserInfoWithUserId","user/showinfo","userid="+t.userId,"showUserInfoWithUserId",t.userId)}},{key:"openApp",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"openApp","app/open","appid="+t.appId,"openApp",t.appId)}},{key:"shareWebMessage",value:function(e){this.createSimpleJssdkFuncFactory(e,"shareWebMessage","web/share","shareWebMessage")}},{key:"getLocalWifiIP",value:function(e){this.createSimpleJssdkFuncFactory(e,"getLocalWifiIP","system/wifi/getip","getLocalWifiIP")}},{key:"getLocalWifiMac",value:function(e){this.createSimpleJssdkFuncFactory(e,"getLocalWifiMac","system/wifi/getmac","getLocalWifiMac")}},{key:"imcropUpload",value:function(e){var t=this.getOption(e),o=t.aspectratio?t.aspectratio:1;this.createSingleParamJssdkFuncFactory(t,"imcropUpload","system/imcrop/upload","aspectratio="+o,"",{})}},{key:"showUserInfo",value:function(e){this.createSimpleJssdkFuncFactory(e,"getCurrentUserInfo","user/current/info","")}},{key:"sendCardToChat",value:function(e){var t=this.getOption(e),o=t.from,i=t.title,a=t.des,s=t.cover,c=t.link,r=this.createCallbackFactory(t,"sendCardToChat");this.createProtocol(this.getProtocol("new","chat/select/send/message",r.suc,r.fail,"from="+o,"title="+i,"des="+a,"cover="+s,"link="+c),"has no this protocol",this.protocolSwitch)}},{key:"sendCardToUser",value:function(e){var t=this.getOption(e),o=t.from,i=t.userid,a=t.title,s=t.des,c=t.cover,r=t.link,n=this.createCallbackFactory(t,"sendCardToUser");this.createProtocol(this.getProtocol("new","user/send/appmessage",n.suc,n.fail,"from="+o,"userid="+i,"title="+a,"des="+s,"cover="+c,"link="+r),"has no this protocol",this.protocolSwitch)}},{key:"getImei",value:function(e){this.createSimpleJssdkFuncFactory(e,"getImei","system/imei","")}},{key:"audio",value:function(e){var t=this.getOption(e),o=t.action;this.createSingleParamJssdkFuncFactory(t,"audio","audio/record","action="+o,"",{})}},{key:"audioPlay",value:function(e){var t=this.getOption(e),o=t.action,i=t.fileUrl,a=this.createCallbackFactory(t,"audioPlay");this.createProtocol(this.getProtocol("new","audio/play",a.suc,a.fail,"fileurl="+i,"action="+o),"has no this protocol",this.protocolSwitch)}},{key:"openThirdApp",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"openThirdApp");"eimAndroid"===this.judge()?this.createProtocol(this.getProtocol("new","open/thirdapp",o.suc,o.fail,"pkg="+t.pkg),"has no this protocol",this.protocolSwitch):this.createProtocol(this.getProtocol("new","open/thirdapp",o.suc,o.fail,"scheme="+t.scheme),"has no this protocol",this.protocolSwitch)}},{key:"uploadAttachment",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"uploadAttachment");this.createProtocol(this.getProtocol("new","upload/attachment",o.suc,o.fail,"url="+t.url,"key="+t.key,"value="+t.value),"has no this protocol",this.protocolSwitch)}},{key:"selectMedia",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"selectMedia","media/select","limit="+t.limit,"",{})}},{key:"uploadMedia",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"uploadMedia");this.createProtocol(this.getProtocol("new","media/upload",o.suc,o.fail,"url="+t.url,"key="+t.key,"value="+t.value,"fileurl="+t.fileurl),"has no this protocol",this.protocolSwitch)}},{key:"ajax",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"ajax"),i=encodeURIComponent(t.url),a=t.method&&/^get|post|put|delete$/.test(t.method.toLowerCase())?t.method.toLowerCase():"get",s={},c=JSON.stringify({});try{s=JSON.stringify(t.data)}catch(e){s=c}var r={};try{r=JSON.stringify(t.header)}catch(e){r=c}var n=t.returnHeader?1:0;this.createProtocol(this.getProtocol("new","system/network",o.suc,o.fail,"url="+i,"data="+encodeURIComponent(s),"method="+a,"header="+encodeURIComponent(r),"is_return_response_without_cookie="+n),"has no this protocol",this.protocolSwitch)}},{key:"ssoLogin",value:function(e){this.createSimpleJssdkFuncFactory(e,"ssoLogin","appstore/sso","")}},{key:"kv",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"kv");"get"===t.action||"delete"===t.action?this.createProtocol(this.getProtocol("new","system/kv",o.suc,o.fail,"action="+t.action,"key="+t.key),"has no this protocol",this.protocolSwitch):this.createProtocol(this.getProtocol("new","system/kv",o.suc,o.fail,"action="+t.action,"key="+t.key,"value="+t.value),"has no this protocol",this.protocolSwitch)}},{key:"network",value:function(e){this.createSimpleJssdkFuncFactory(e,"network","system/network/status","network")}},{key:"cache",value:function(e){console.log(e);var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"cache","system/cache","action="+t.action,"cache",t.action)}}]),o}()});
