!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EimMobileJsSdk=t()}(this,function(){"use strict";var i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}(),t=function(){function t(e){i(this,t),this.protocolSwitch=e||"new"}return s(t,[{key:"firstUpperCase",value:function(e){return e.toLowerCase().replace(/( |^)[a-z]/g,function(e){return e.toUpperCase()})}},{key:"randomId",value:function(e){e=e||10;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=t.length,i="",s=0;s<e;s++)i+=t.charAt(Math.floor(Math.random()*o));return i}},{key:"judge",value:function(){return-1<window.navigator.userAgent.indexOf("eimAndroid")?"eimAndroid":"eimios"}},{key:"getOption",value:function(e){return Object.assign({},this.opts,e)}},{key:"getCallbackName",value:function(e,t,o){var i=this.firstUpperCase(e),s=o?this.firstUpperCase(o):this.firstUpperCase(this.randomId(6));return"success"===t?"eimMobileJsSdk"+i+s+"Success":"eimMobileJsSdk"+i+s+"Faile"}},{key:"getProtocol",value:function(e,t,o,i){for(var s="",a="",n=arguments.length,r=Array(4<n?n-4:0),c=4;c<n;c++)r[c-4]=arguments[c];if("old"===e){a=r.join("_");var l=t.split("_");if(s="eim://"+l[0]+"_"+o+"_"+i,1<l.length)for(var u=1;u<t.split("_").length;u++)s+="_"+l[u];s+="/"+a}else s=(a=r.join("&"))?"eim://com.comtop.eim/"+t+"?succallback="+o+"&failcallback="+i+"&"+a:"eim://com.comtop.eim/"+t+"?succallback="+o+"&failcallback="+i;return s}},{key:"createCallbackFactory",value:function(e,t){var o=this.getCallbackName(t,"success",e.id),i=this.getCallbackName(t,"fail",e.id);return window[o]=e.success,window[i]=e.fail,{suc:o,fail:i}}},{key:"createProtocol",value:function(e,t,o){"new"===o&&"has no this protocol"===e||"old"===o&&"has no this protocol"===t||(window.location.href="new"===o?e:t)}},{key:"createSimpleJssdkFuncFactory",value:function(e,t,o,i){var s=this.getOption(e),a=this.createCallbackFactory(s,t),n=""===o?"has no this protocol":this.getProtocol("new",o,a.suc,a.fail),r=""===i?"has no this protocol":this.getProtocol("old",i,a.suc,a.fail);this.createProtocol(n,r,this.protocolSwitch)}},{key:"createSingleParamJssdkFuncFactory",value:function(e,t,o,i,s,a){var n=this.createCallbackFactory(e,t),r=""===o?"has no this protocol":this.getProtocol("new",o,n.suc,n.fail,i),c=""===s?"has no this protocol":this.getProtocol("old",s,n.suc,n.fail,a);this.createProtocol(r,c,this.protocolSwitch)}}]),t}();return function(e){function o(e){i(this,o);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return t.protocolSwitch=e||"new",t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,t),s(o,[{key:"selectPhoto",value:function(e){var t=this.getOption(e),o=t.count?t.count:1;this.createSingleParamJssdkFuncFactory(t,"selectPhoto","photo/select","limit="+o,"selectPhoto",o)}},{key:"imcrop",value:function(e){var t=this.getOption(e),o=t.aspectratio?t.aspectratio:1,i=t.quality?t.quality:0,s=t.shotonly?t.shotonly:0,a=this.createCallbackFactory(t,"imcrop");this.createProtocol(this.getProtocol("new","system/imcrop",a.suc,a.fail,"aspectratio="+o,"quality="+i,"shotonly="+s),this.getProtocol("old","imcrop",a.suc,a.fail,o,i,s),this.protocolSwitch)}},{key:"selectUser",value:function(e){var t=this.getOption(e),o=t.maxLimit||99,i=this.createCallbackFactory(t,"selectUser"),s=t.ignoreself?"/ignoreSelf":"",a=t.ignoreself?1:0,n=t.selecteduids&&0!==t.selecteduids.length?""+t.selecteduids.join("_"):"",r=t.selecteduids&&0!==t.selecteduids.length?""+t.selecteduids.join(","):"";this.createProtocol(this.getProtocol("new","user/select",i.suc,i.fail,"maxlimit="+o,"ignoreself="+a,"selecteduids="+r),this.getProtocol("old","selectUser_"+o,i.suc,i.fail,""+n+s),this.protocolSwitch)}},{key:"selectDept",value:function(e){var t=this.getOption(e),o=t.maxLimit||99,i=this.createCallbackFactory(t,"selectDept"),s=t.ignoreself?"/ignoreself":"",a=t.ignoreself?1:0,n=t.selectedids&&0!==t.selectedids.length?t.selectedids.join("_"):"",r=t.selectedids&&0!==t.selectedids.length?""+t.selectedids.join(","):"";this.createProtocol(this.getProtocol("new","dept/select",i.suc,i.fail,"maxlimit="+o,"ignoreself="+a,"selectedids="+r),this.getProtocol("old","selectDept_"+o,i.suc,i.fail,""+n+s),this.protocolSwitch)}},{key:"screenRotation",value:function(e){var t=this.getOption(e),o=t.param?t.param:"vertical",i=this.createCallbackFactory(t,"screenRotation");this.createProtocol(this.getProtocol("new","system/screen",i.suc,i.fail,"action="+o),this.getProtocol("old","screenRotation",i.suc,i.fail,""+o),this.protocolSwitch)}},{key:"phoneCall",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"phoneCall","system/phonecall","phonenum="+t.phoneNumber,"phoneCall",t.phoneNumber)}},{key:"openQRCode",value:function(e){var t=this.getOption(e),o=t.needResult?t.needResult:1;this.createSingleParamJssdkFuncFactory(t,"openQRCode","qrcode/scan","needresult="+o,"openQRCode",o)}},{key:"scanQRCode",value:function(e){var t=this.getOption(e),o=1===t.needResult||0===t.needResult?t.needResult:1;this.createSingleParamJssdkFuncFactory(t,"scanQRCode","qrcode/scan","needresult="+o,"scanQRCode",o)}},{key:"openEditText",value:function(e){var t=this.getOption(e),o=t.text?t.text:"发送",i=t.type?t.type:"number",s=t.content,a=this.createCallbackFactory(t,"openEditText");this.createProtocol(this.getProtocol("new","web/input/text",a.suc,a.fail,"type="+i,"text="+o,"content="+s),this.getProtocol("old","openEditText",a.suc,a.fail,o,i,s),this.protocolSwitch)}},{key:"openFile",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"openFile","file/open","json="+o,"openFile",o)}},{key:"uploadFile",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"uploadFile","file/upload","json="+o,"uploadFile",o)}},{key:"previewFile",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"previewFile","file/preview","json="+o,"previewFile",o)}},{key:"getFileDownloadList",value:function(e){var t=this.getOption(e),o=t.fileStr;this.createSingleParamJssdkFuncFactory(t,"getFileDownloadList","file/getdownloadlist","json="+o,"getFileDownloadList",o)}},{key:"menuList",value:function(e){var t=this.getOption(e),o=t.menulist&&0!==t.menulist.length?t.menulist.join("_"):"",i=t.menulist&&0!==t.menulist.length?t.menulist.join(","):"";this.createSingleParamJssdkFuncFactory(t,"menuList","menu/list","menulist="+i,"menuList",o)}},{key:"onMenu",value:function(e){var t=this.getOption(e),o=t.type;this.createSingleParamJssdkFuncFactory(t,"onMenu","web/menu/action","name="+o,"onMenu",o)}},{key:"logout",value:function(e){this.createSimpleJssdkFuncFactory(e,"logout","user/logout","logout")}},{key:"closeWindow",value:function(e){var t="eimAndroid"===this.judge()?"closecurrentwindow":"closeWindow";this.createSimpleJssdkFuncFactory(e,"closeWindow","web/close",t)}},{key:"banPull",value:function(e){var t=this.getOption(e),o=t?t.pull:"";this.createSingleParamJssdkFuncFactory(t,"banPull","web/banpull","pull="+o,"banPull",null)}},{key:"goBack",value:function(e){var t="eimAndroid"===this.judge()?"closeWindow":"goBack";this.createSimpleJssdkFuncFactory(e,"goBack","web/goback",t)}},{key:"hiddenNavigationBar",value:function(e){var t=this.getOption(e),o=t?t.action:"";this.createSingleParamJssdkFuncFactory(t,"hiddenNavigationBar","web/navigationbar/toggler","action="+o,"hiddenNavigationBar",null)}},{key:"closeShouldAutorotate",value:function(e){this.createSimpleJssdkFuncFactory(e,"closeShouldAutorotate","system/closerotate","closeShouldAutorotate")}},{key:"clipBoard",value:function(e){var t=this.getOption(e),o=t.text;this.createSingleParamJssdkFuncFactory(t,"clipBoard","system/clipboard","content="+o,"clipBoard",o)}},{key:"refreshPubService",value:function(e){var t=this.getOption(e),o=t.action;this.createSingleParamJssdkFuncFactory(t,"refreshPubService","pubservice/refresh","action="+o,"refreshpubservice",o)}},{key:"setEarpieceMode",value:function(e){this.createSimpleJssdkFuncFactory(e,"setEarpieceMode","system/earpiece","setEarpieceMode")}},{key:"isInstalled",value:function(e){var t=this.getOption(e),o=t.packageName;this.createSingleParamJssdkFuncFactory(t,"isInstalled","app/installed","name="+o,"isInstalled",o)}},{key:"choosePhoto",value:function(e){var t=this.getOption(e),o=t.maxLimit;this.createSingleParamJssdkFuncFactory(t,"choosePhoto","photo/choose","maxlimit="+o,"choosePhoto",o)}},{key:"setTitleVisibility",value:function(e){var t=this.getOption(e),o=t.isShow||void 0===t.isShow?"visible":"gone",i=this.createCallbackFactory(t,"groupCreate");this.createProtocol("has no this protocol",this.getProtocol("old","setTitleVisibility",i.suc,i.fail,o),this.protocolSwitch)}},{key:"playVideo",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"playVideo","video/play","json="+t.videoJson,"playVideo",t.videoJson)}},{key:"showVoiceInput",value:function(e){this.createSimpleJssdkFuncFactory(e,"showVoiceInput","voice/input","showVoiceInput")}},{key:"openZoom",value:function(e){this.createSimpleJssdkFuncFactory(e,"openZoom","system/zoom","openZoom")}},{key:"getLocation",value:function(e){this.createSimpleJssdkFuncFactory(e,"getLocation","system/getlocation","getLocation")}},{key:"groupCreate",value:function(e){var t=this.getOption(e),o=this.createCallbackFactory(t,"groupCreate");this.createProtocol(this.getProtocol("new","group/create",o.suc,o.fail,"groupname="+t.groupname,"groupmark="+t.groupmark),this.getProtocol("old","groupCreate",o.suc,o.fail),this.protocolSwitch)}},{key:"dissolve",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"dissolve","group/dissolve","roomid="+t.roomId,"groupDissolveWithRoomId",t.roomId)}},{key:"groupOpen",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"groupOpen","group/open","roomid="+t.roomId,"groupOpenWithRoomId",t.roomId)}},{key:"groupExit",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"groupExit","group/exit","roomid="+t.roomId,"exitGroup",t.roomId)}},{key:"refreshMyInfo",value:function(e){this.createSimpleJssdkFuncFactory(e,"refreshMyInfo","user/refreshself","refreshMyInfo")}},{key:"showUserInfoWithUserId",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"showUserInfoWithUserId","user/showinfo","userid="+t.userId,"showUserInfoWithUserId",t.userId)}},{key:"openApp",value:function(e){var t=this.getOption(e);this.createSingleParamJssdkFuncFactory(t,"openApp","app/open","appid="+t.appId,"openApp",t.appId)}},{key:"shareWebMessage",value:function(e){this.createSimpleJssdkFuncFactory(e,"shareWebMessage","web/share","shareWebMessage")}},{key:"getLocalWifiIP",value:function(e){this.createSimpleJssdkFuncFactory(e,"getLocalWifiIP","system/wifi/getip","getLocalWifiIP")}},{key:"getLocalWifiMac",value:function(e){this.createSimpleJssdkFuncFactory(e,"getLocalWifiMac","system/wifi/getmac","getLocalWifiMac")}},{key:"imcropUpload",value:function(e){var t=this.getOption(e),o=t.aspectratio?t.aspectratio:1;this.createSingleParamJssdkFuncFactory(t,"imcropUpload","system/imcrop/upload","aspectratio="+o,"",{})}},{key:"showUserInfo",value:function(e){this.createSimpleJssdkFuncFactory(e,"getCurrentUserInfo","user/current/info","")}},{key:"sendCardToChat",value:function(e){var t=this.getOption(e),o=t.from,i=t.title,s=t.des,a=t.cover,n=t.link,r=this.createCallbackFactory(t,"sendCardToChat");this.createProtocol(this.getProtocol("new","chat/select/send/message",r.suc,r.fail,"from="+o,"title="+i,"des="+s,"cover="+a,"link="+n),"has no this protocol",this.protocolSwitch)}},{key:"sendCardToUser",value:function(e){var t=this.getOption(e),o=t.from,i=t.userid,s=t.title,a=t.des,n=t.cover,r=t.link,c=this.createCallbackFactory(t,"sendCardToUser");this.createProtocol(this.getProtocol("new","user/send/appmessage",c.suc,c.fail,"from="+o,"userid="+i,"title="+s,"des="+a,"cover="+n,"link="+r),"has no this protocol",this.protocolSwitch)}}]),o}()});
